<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <button onclick="login()">Login</button>
    <button onclick="me()">Me</button>
    <!--<button onclick="getSession()">Get session</button>-->
    <button onclick="getLoginStatus()">Get login</button>
    <button onclick="logout()">Logout</button>
    <button onclick="facebookWallPost()">facebookWallPost</button>
    <button onclick="publishStoryFriend()">friendstory</button>
    <button onclick="start()">share!</button>
    <button onclick="whereIam()">where I am ?</button>

    <div id="data">loading ...</div>

    <!--<script src="http://localhost:8080/target/target-script-min.js#anonymous"></script>-->
    <div id="fb-root"></div>
    <!-- cordova -->
    <script src="cordova.js"></script>
    <!-- cordova facebook plugin -->
    <script src="cdv-plugin-fb-connect.js"></script>
    <!-- facebook js sdk -->
    <script src="facebook-js-sdk.js"></script>

    <script>
             
    loggedIn = false;

    if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
    if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
    if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');

    FB.Event.subscribe('auth.login', function (response) {
        loggedIn = true;
    });

    FB.Event.subscribe('auth.logout', function (response) {
        loggedIn = false;
    });

    FB.Event.subscribe('auth.sessionChange', function (response) {
        alert('auth.sessionChange event');
    });

    FB.Event.subscribe('auth.statusChange', function (response) {
        alert('auth.statusChange event');
    });

    /*function getSession() {
        alert("session: " + JSON.stringify(FB.getSession()));
    }
    */

    function whereIam() {
        alert(document.URL);
    }

    function start() {
        FB.getLoginStatus(function (response) {
            if (response.status == 'connected') {
                me();
            } else {
                FB.login(
                function (response) {
                    if (response.authResponse) {
                        me();
                    } else {
                        alert('Please login to FaceBook to share');
                    }
                },
                { scope: 'email,publish_stream,user_birthday' }
                );
            }
        });
    }

    function getLoginStatus() {
        FB.getLoginStatus(function (response) {
            if (response.status == 'connected') {
                alert('getLoginStatus.logged in');
            } else {
                alert('getLoginStatus.not logged in');
            }
        });
    }
    var friendIDs = [];
    var fdata;

    function me() {


        // /me/permissions sample response
        var r = {
            "data": [
              {
                  "installed": 1,
                  "basic_info": 1,
                  "status_update": 1,
                  "photo_upload": 1,
                  "video_upload": 1,
                  "email": 1,
                  "create_note": 1,
                  "share_item": 1,
                  "publish_stream": 1,
                  "publish_actions": 1,
                  "user_birthday": 1,
                  "user_friends": 1
              }
            ],
            "paging": {
                "next": "https://graph.facebook.com/100004957860745/permissions?limit=5000&offset=5000"
            }
        };


        FB.api('/me/permissions', function (response) {
            if (response.data[0].publish_stream) {

                var body = 'http://neoltsal.blog.hu/2013/08/07/foodnotbombs';
                FB.api('/me/feed', 'post', { link: body }, function (response) {
                    if (!response || response.error) {
                        alert('Error occured');
                    } else {
                        alert('Post ID: ' + response.id);
                    }
                });

            }
            else {

                if (confirm('Get publish_stream permission?')) {
                    start();
                } else {
                    // Do nothing!
                }

            }
        });
               
    }

    function logout() {
        FB.logout(function (response) {
            alert('logout.logged out');
        });
    }

    function login() {
        FB.login(
                 function (response) {
                     if (response.authResponse) {
                         alert('login.logged in' + JSON.stringify(response));
                     } else {
                         alert('login.not logged in' + JSON.stringify(response));
                     }
                 },
                 { scope: "email" }
                 );
    }


    function facebookWallPost() {
        console.log('Debug 1');
        var params = {
            method: 'feed',
            name: 'Facebook Dialogs',
            link: 'https://developers.facebook.com/docs/reference/dialogs/',
            picture: 'http://fbrell.com/f8.jpg',
            caption: 'Reference Documentation',
            description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
        };
        console.log(params);
        FB.ui(params, function (obj) { console.log(obj); });
    }

    function publishStoryFriend() {
        randNum = Math.floor(Math.random() * friendIDs.length);

        var friendID = friendIDs[randNum];
        if (friendID == undefined) {
            alert('please click the me button to get a list of friends first');
        } else {
            console.log("friend id: " + friendID);
            console.log('Opening a dialog for friendID: ', friendID);
            var params = {
                method: 'feed',
                to: friendID.toString(),
                name: 'Facebook Dialogs',
                link: 'https://developers.facebook.com/docs/reference/dialogs/',
                picture: 'http://fbrell.com/f8.jpg',
                caption: 'Reference Documentation',
                description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
            };
            FB.ui(params, function (obj) { console.log(obj); });
        }
    }

    document.addEventListener('deviceready', function () {
        try {
            alert('Device is ready! Make sure you set your app_id below this alert.');
            FB.init({ appId: "196259003864955", nativeInterface: CDV.FB, useCachedDialogs: false });
            document.getElementById('data').innerHTML = "";
        } catch (e) {
            alert(e);
        }
    }, false);
            </script>
    <div id="log"></div>
</body>
</html>
